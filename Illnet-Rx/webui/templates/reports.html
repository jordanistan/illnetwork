{% extends "layout.html" %}
{% block title %}Consultation History - Illnet Rx{% endblock %}

{% block content %}
<div class="card">
  <div class="card-header">
    <h2>Consultation History</h2>
    <form action="{{ url_for('clear_reports') }}" method="post" style="margin: 0;">
      <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete all reports? This action cannot be undone.');">
        Clear All Reports
      </button>
    </form>
  </div>
  <div class="card-content">
    {% if reports %}
      <table class="styled-table">
        <thead>
          <tr>
            <th>Scan Date</th>
            <th>Target Host</th>
            <th>Severity</th>
            <th>Report</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for report in reports %}
            <tr>
              <td>{{ report.date }}</td>
              <td>{{ report.hostname }}</td>
              <td><span class="badge badge-{{ report.severity.lower() }}">{{ report.severity }}</span></td>
              <td>{{ report.display_name }}</td>
              <td>
                <a href="{{ url_for('view_report', filename=report.filename) }}" class="btn">View</a>
                <form action="{{ url_for('remediate_report', filename=report.filename) }}" method="post" style="display: inline;">
                  <button type="submit" class="btn btn-primary">Generate Rx</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No consultation reports found. Run a diagnosis to generate one.</p>
    {% endif %}
  </div>
</div>
{% endblock %}